const conversionFactor=180/Math.PI;let radianToDegrees=function(t){return t*conversionFactor},degreesToRadian=function(t){return t/conversionFactor};class Vector{constructor(t,e){this.x=t,this.y=e}reset(t,e){this.x=t,this.y=e}resetToVector(t){t instanceof Vector&&(this.x=t.x,this.y=t.y)}clone(){return new Vector(this.x,this.y)}add(t){return this.x+=t.x,this.y+=t.y,this}addNew(t){return this.clone().add(t)}addScalar(t){return this.add(new Vector(t,t))}addScalarNew(t){return this.clone().addScalar(t)}subtract(t){return this.x-=t.x,this.y-=t.y,this}subtractNew(t){return this.clone().subtract(t)}subtractScalar(t){return this.subtract(new Vector(t,t))}subtractScalarNew(t){return this.clone().subtractScalar(t)}divide(t){return 0!==t.x?this.x/=t.x:this.x=0,0!==t.y?this.y/=t.y:this.y=0,this}divideNew(t){return this.clone().divide(t)}divideScalar(t){var e=new Vector(t,t);return this.divide(e)}divideScalarNew(t){return this.clone().divideScalar(t)}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyNew(t){return this.clone().multiply(t)}multiplyScalar(t){var e=new Vector(t,t);return this.multiply(e)}multiplyScalarNew(t){return this.clone().multiplyScalar(t)}scale(t){return this.multiplyScalar(t)}scaleNew(t){return this.multiplyScalarNew(t)}rotate(t){var e=this.x*Math.cos(t)-this.y*Math.sin(t),i=this.x*Math.sin(t)+this.y*Math.cos(t);return this.x=e,this.y=i,this}rotateNew(t){return this.clone().rotate(t)}rotateDeg(t){return this.rotate(degreesToRadian(t))}rotateDegNew(t){return this.rotateNew(degreesToRadian(t))}rotateBy(t){return this.rotate(t)}rotateByNew(t){return this.rotateNew(t)}rotateDegBy(t){return this.rotateDeg(t)}rotateDegByNew(t){return tjos.rotateDegNew(t)}rotateTo(t){return this.rotate(t-this.angle)}rotateToNew(t){return this.clone().rotateTo(t)}rotateToDeg(t){return this.rotateTo(degreesToRadian(t))}rotateToDegNew(t){return this.rotateToNew(degreesToRadian(t))}normalise(){return this.divideScalar(this.length)}normaliseNew(){return this.divideScalarNew(this.length)}distance(t){return this.subtractNew(t).length}distanceX(t){return this.x-t.x}distanceY(t){return this.y-t.y}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.x-this.y*t.y}isEqualTo(t){return this.x===t.x&&this.y===t.y}slopeOf(t){return(t.y-this.y)/(t.x-this.x)}set x(t){if("number"!=typeof t)throw new TypeError("X should be a number");this._x=t}get x(){return this._x||0}set y(t){if("number"!=typeof t)throw new TypeError("Y should be a number");this._y=t}get y(){return this._y||0}set lengthSquared(t){var e;if("number"!=typeof t)throw new TypeError("length should be a number");e=t/this.lengthSquared,this.multiplyScalar(e)}get lengthSquared(){return this.x*this.x+this.y*this.y}set length(t){var e;if("number"!=typeof t)throw new TypeError("length should be a number");e=t/this.length,this.multiplyScalar(e)}get length(){return Math.sqrt(this.lengthSquared)}set angle(t){if("number"!=typeof t)throw new TypeError("angle should be a number");this.rotateTo(t)}get angle(){return Math.atan2(this.y,this.x)}set angleInDegrees(t){if("number"!=typeof t)throw new TypeError("angle should be a number");this.rotateToDeg(t)}get angleInDegrees(){return radianToDegrees(Math.atan2(this.y,this.x))}set width(t){this.x=t}get width(){return this.x}set height(t){this.y=t}get height(){return this.y}get area(){return this.x*this.y}get slope(){return this.y/this.x}}const ring=document.getElementById("ring"),smoothstep=function(t,e,i){let s=(i-t)/(e-t);return(s=Math.min(Math.max(s,0),1))*s*(3-2*s)};class Particle{constructor(t,e){this._canvas=document.createElement("canvas"),this.canvas.width=this.dimensions.width+2,this.canvas.width=this.dimensions.height+2,this.ctx=this.canvas.getContext("2d"),this.position=t,this.velocity=e,this.render()}render(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.beginPath(),this.ctx.lineWidth=2,this.ctx.strokeStyle="#BFE2FF",this.ctx.arc(this.halfDims.width+1,this.halfDims.height+1,this.halfDims.width,0,2*Math.PI),this.ctx.stroke(),this.ctx.closePath(),this.ctx.beginPath(),this.ctx.arc(this.halfDims.width+1,this.halfDims.height+1,this.halfDims.width-this.ringWidth,0,2*Math.PI),this.ctx.stroke()}solve(){const t=new Vector(0,0);let e=mousepos.subtractNew(this.position),i=e.lengthSquared,s=Math.sqrt(i),r=5e3/(i*s);r*=smoothstep(300,0,s),t.subtract(e.scale(r)),this.render();const n=e=>{const i=e.position.subtractNew(this.position),r=i.lengthSquared,n=2e4/(s=Math.sqrt(r))/(r*s);if(200>s){let t=.5*smoothstep(200,50,s);const r=this.position.clone(),n=new Vector(this.halfDims.width-5,0).rotate(i.angle);r.add(n),this.controller.ctx.beginPath(),this.controller.ctx.moveTo(r.x,r.y),this.controller.ctx.lineWidth=3,this.controller.ctx.strokeStyle=`rgba(191, 226, 255,${t})`,r.resetToVector(e.position),r.subtract(n),this.controller.ctx.lineTo(r.x,r.y),this.controller.ctx.stroke(),t=smoothstep(200,50,s),this.ctx.beginPath(),this.ctx.strokeStyle=`rgba(191, 226, 255,${t})`,this.ctx.lineWidth=this.ringWidth,this.ctx.arc(this.halfDims.width+1,this.halfDims.height+1,this.halfDims.width-.5*this.ringWidth,i.angle-t,i.angle+t),this.ctx.stroke()}t.subtract(i.scale(n))};this.controller.particles.forEach(t=>{t!==this&&n(t)}),this.velocity.add(t),this.velocity.length>5&&(this.velocity.length=5),this.velocity.scale(.995),this.position.add(this.velocity),this.position.x>this.controller.dimensions.x+4*this.dimensions.x?this.position.x=-this.dimensions.x:this.position.x<4*-this.dimensions.x&&(this.position.x=this.controller.dimensions.x+this.dimensions.x),this.position.y>this.controller.dimensions.y+4*this.dimensions.y?this.position.y=-this.dimensions.y:this.position.y<4*-this.dimensions.y&&(this.position.y=this.controller.dimensions.y+this.dimensions.y)}get canvas(){return this._canvas}set position(t){t instanceof Vector&&(this._position=t)}get position(){return this._position instanceof Vector||(this.position=new Vector(0,0)),this._position}set velocity(t){t instanceof Vector&&(this._velocity=t)}get velocity(){return this._velocity instanceof Vector||(this.velocity=new Vector(0,0)),this._velocity}set dimensions(t){t instanceof Vector&&(this._dimensions=t,this._halfDims=t.multiplyScalarNew(.5),this.canvas.width=this.dimensions.width+2,this.canvas.height=this.dimensions.height+2)}get dimensions(){return this._dimensions instanceof Vector||(this.dimensions=new Vector(50,50)),this._dimensions}get halfDims(){return this._halfDims}get ringWidth(){return 10}}class Stage{constructor(t,e){this._canvas=document.createElement("canvas"),this.resize(t,e),this.ctx=this.canvas.getContext("2d"),this.run=this.run.bind(this)}run(){!0===this.running&&requestAnimationFrame(this.run),this.render()}render(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.particles.forEach(t=>{t.solve();const e=t.position.subtractNew(t.halfDims);this.ctx.drawImage(t.canvas,e.x,e.y)})}resize(t,e){this.dimensions=new Vector(t,e)}addParticle(t){t instanceof Particle&&t.controller!==this&&(t.controller&&t.controller.removeParticle(t),t.controller=this,this.particles.push(t))}removeParticle(t){this.particles.forEach((e,i)=>{e===t&&this.particles.splice(i,1)})}set dimensions(t){t instanceof Vector&&(this._dimensions=t,this._halfDims=t.multiplyScalarNew(.5),this.canvas.width=this.dimensions.width,this.canvas.height=this.dimensions.height)}get dimensions(){return this._dimensions instanceof Vector||(this.dimensions=new Vector(50,50)),this._dimensions}get halfDims(){return this._halfDims}get canvas(){return this._canvas}get particles(){return this._particles||(this._particles=[]),this._particles}set running(t){!1===this.running&&!0===t&&(this._running=!0,requestAnimationFrame(this.run))}get running(){return!0===this._running}}const app=new Stage(ring.offsetWidth,ring.offsetHeight),numParticles=ring.offsetWidth*ring.offsetHeight*8e-5;for(let t=0;numParticles>t;t++)app.addParticle(new Particle(new Vector(Math.random()*ring.offsetWidth,Math.random()*ring.offsetHeight),new Vector(0,0)));const mousepos=new Vector(-1e3,0);ring.addEventListener("pointermove",t=>{mousepos.x=t.clientX-ring.getBoundingClientRect().left,mousepos.y=t.clientY-ring.getBoundingClientRect().top}),ring.appendChild(app.canvas),window.addEventListener("resize",t=>{app.resize(ring.offsetWidth,ring.offsetHeight)}),app.running=!0;